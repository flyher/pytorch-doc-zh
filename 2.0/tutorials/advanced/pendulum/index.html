
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pytorch.apachecn.org/2.0/tutorials/advanced/pendulum/">
      
      
        <link rel="prev" href="../../intermediate/mario_rl_tutorial/">
      
      
        <link rel="next" href="../../beginner/onnx/intro_onnx/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Pendulum: Writing your environment and transforms with TorchRL - 【布客】PyTorch 中文翻译</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.3cba04c6.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytorch-pendulum-torchrl" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="【布客】PyTorch 中文翻译" class="md-header__button md-logo" aria-label="【布客】PyTorch 中文翻译" data-md-component="logo">
      
  <img src="https://data.apachecn.org/img/logo/logo_green.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            【布客】PyTorch 中文翻译
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pendulum: Writing your environment and transforms with TorchRL
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/apachecn/pytorch-doc-zh" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    apachecn/pytorch-doc-zh
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="【布客】PyTorch 中文翻译" class="md-nav__button md-logo" aria-label="【布客】PyTorch 中文翻译" data-md-component="logo">
      
  <img src="https://data.apachecn.org/img/logo/logo_green.png" alt="logo">

    </a>
    【布客】PyTorch 中文翻译
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/apachecn/pytorch-doc-zh" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    apachecn/pytorch-doc-zh
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 中文文档 & 教程
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PyTorch 新特性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            PyTorch 新特性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V2.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V2.3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V2.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V2.2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V2.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V2.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V2.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V2.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.13
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.11
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.10
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.9
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LatestChanges/PyTorch_V1.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V1.2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PyTorch 2.x 中文文档 & 教程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            PyTorch 2.x 中文文档 & 教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    中文教程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            中文教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PyTorch Recipes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            PyTorch Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/recipes_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    See All Recipes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototype/prototype_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    See All Prototype Recipes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction to PyTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction to PyTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn the Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/quickstart_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/tensorqs_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tensors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/data_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets & DataLoaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/transforms_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/buildmodel_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build the Neural Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/autogradqs_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic Differentiation with torch.autograd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/optimization_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimizing Model Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/basics/saveloadrun_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Save and Load the Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction to PyTorch on YouTube
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            Introduction to PyTorch on YouTube
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to PyTorch - YouTube Series
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/introyt1_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/tensors_deeper_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to PyTorch Tensors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/autogradyt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Fundamentals of Autograd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/modelsyt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Models with PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/tensorboardyt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch TensorBoard Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/trainingyt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training with PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/introyt/captumyt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Understanding with Captum
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learning PyTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            Learning PyTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/deep_learning_60min_blitz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deep Learning with PyTorch: A 60 Minute Blitz
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/pytorch_with_examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learning PyTorch with Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/nn_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is torch.nn really?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/tensorboard_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizing Models, Data, and Training with TensorBoard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_5" >
        
          
          <label class="md-nav__link" for="__nav_3_1_5" id="__nav_3_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Image and Video
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_5">
            <span class="md-nav__icon md-icon"></span>
            Image and Video
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/torchvision_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchVision Object Detection Finetuning Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/transfer_learning_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transfer Learning for Computer Vision Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/fgsm_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adversarial Example Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/dcgan_faces_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DCGAN Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/spatial_transformer_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spatial Transformer Networks Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/vt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimizing Vision Transformer Model for Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/tiatoolbox_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Whole Slide Image Classification Using PyTorch and TIAToolbox
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_6" >
        
          
          <label class="md-nav__link" for="__nav_3_1_6" id="__nav_3_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Audio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_6">
            <span class="md-nav__icon md-icon"></span>
            Audio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_io_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_resampling_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Resampling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_data_augmentation_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Data Augmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_feature_extractions_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Feature Extractions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_feature_augmentation_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Feature Augmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/audio_datasets_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/speech_recognition_pipeline_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Speech Recognition with Wav2Vec2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/text_to_speech_with_torchaudio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text-to-speech with Tacotron2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/forced_alignment_with_torchaudio_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forced Alignment with Wav2Vec2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7" >
        
          
          <label class="md-nav__link" for="__nav_3_1_7" id="__nav_3_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Text
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7">
            <span class="md-nav__icon md-icon"></span>
            Text
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/bettertransformer_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fast Transformer Inference with Better Transformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/char_rnn_classification_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLP From Scratch: Classifying Names with a Character-Level RNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/char_rnn_generation_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLP From Scratch: Generating Names with a Character-Level RNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/seq2seq_translation_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLP From Scratch: Translation with a Sequence to Sequence Network and Attention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/text_sentiment_ngrams_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text classification with the torchtext library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/translation_transformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Language Translation with nn.Transformer and torchtext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/torchtext_custom_dataset_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocess custom text dataset using Torchtext
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_8" >
        
          
          <label class="md-nav__link" for="__nav_3_1_8" id="__nav_3_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backends
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_8">
            <span class="md-nav__icon md-icon"></span>
            Backends
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/onnx/intro_onnx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to ONNX
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_9" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_9" id="__nav_3_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reinforcement Learning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_9">
            <span class="md-nav__icon md-icon"></span>
            Reinforcement Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/reinforcement_q_learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reinforcement Learning (DQN) Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/reinforcement_ppo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reinforcement Learning (PPO) with TorchRL Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/mario_rl_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train a Mario-playing RL Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pendulum: Writing your environment and transforms with TorchRL
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pendulum: Writing your environment and transforms with TorchRL
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      主要学习内容：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_step" class="md-nav__link">
    <span class="md-ellipsis">
      对动作的效果进行编码：_step()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_reset" class="md-nav__link">
    <span class="md-ellipsis">
      重置模拟器：_reset()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#env_spec" class="md-nav__link">
    <span class="md-ellipsis">
      环境元数据 env.*_spec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specs-shape" class="md-nav__link">
    <span class="md-ellipsis">
      Specs shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      可重复的实验：播种
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#envbase" class="md-nav__link">
    <span class="md-ellipsis">
      将事物包装在一起：EnvBase类
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      测试我们的环境
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      转换环境
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      编写自定义转换
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      执行
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batching" class="md-nav__link">
    <span class="md-ellipsis">
      Batching 计算
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      训练一个简单的策略
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      训练循环
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_10" >
        
          
          <label class="md-nav__link" for="__nav_3_1_10" id="__nav_3_1_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deploying PyTorch Models in Production
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_10">
            <span class="md-nav__icon md-icon"></span>
            Deploying PyTorch Models in Production
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/onnx/intro_onnx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to ONNX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/flask_rest_api_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying PyTorch in Python via a REST API with Flask
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/Intro_to_TorchScript_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to TorchScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp_export/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loading a TorchScript Model in C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../super_resolution_with_onnxruntime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (optional) Exporting a Model from PyTorch to ONNX and Running it using ONNX Runtime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/realtime_rpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Real Time Inference on Raspberry Pi 4 (30 fps!)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_11" >
        
          
          <label class="md-nav__link" for="__nav_3_1_11" id="__nav_3_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Profiling PyTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_11">
            <span class="md-nav__icon md-icon"></span>
            Profiling PyTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/profiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling your PyTorch Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/hta_intro_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Holistic Trace Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/hta_trace_diff_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace Diff using Holistic Trace Analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_12" >
        
          
          <label class="md-nav__link" for="__nav_3_1_12" id="__nav_3_1_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code Transforms with FX
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_12">
            <span class="md-nav__icon md-icon"></span>
            Code Transforms with FX
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/fx_conv_bn_fuser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Building a Convolution/Batch Norm fuser in FX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/fx_profiling_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Building a Simple CPU Performance Profiler with FX
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13" >
        
          
          <label class="md-nav__link" for="__nav_3_1_13" id="__nav_3_1_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Frontend APIs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_13">
            <span class="md-nav__icon md-icon"></span>
            Frontend APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/memory_format_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Channels Last Memory Format in PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/forward_ad_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forward-mode Automatic Differentiation (Beta)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/jacobians_hessians/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jacobians, Hessians, hvp, vhp, and more: composing function transforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/ensembling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model ensembling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/per_sample_grads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Per-sample-gradients
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp_frontend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using the PyTorch C++ Frontend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../torch-script-parallelism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Parallelism in TorchScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp_autograd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autograd in C++ Frontend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_14" >
        
          
          <label class="md-nav__link" for="__nav_3_1_14" id="__nav_3_1_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extending PyTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_14">
            <span class="md-nav__icon md-icon"></span>
            Extending PyTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/custom_function_double_backward_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Double Backward with Custom Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/custom_function_conv_bn_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fusing Convolution and Batch Norm using Custom Function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp_extension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom C++ and CUDA Extensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../torch_script_custom_ops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending TorchScript with Custom C++ Operators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../torch_script_custom_classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending TorchScript with Custom C++ Classes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dispatcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Registering a Dispatched Operator in C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extend_dispatcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extending dispatcher for a new backend in C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../privateuseone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Facilitating New Backend Integration by PrivateUse1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_15" >
        
          
          <label class="md-nav__link" for="__nav_3_1_15" id="__nav_3_1_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Optimization
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_15">
            <span class="md-nav__icon md-icon"></span>
            Model Optimization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/profiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling your PyTorch Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/tensorboard_profiler_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch Profiler With TensorBoard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/hyperparameter_tuning_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hyperparameter tuning with Ray Tune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/vt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimizing Vision Transformer Model for Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/parametrizations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parametrizations Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/pruning_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pruning Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_quantization_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Dynamic Quantization on an LSTM Word Language Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/dynamic_quantization_bert_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Dynamic Quantization on BERT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/quantized_transfer_learning_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Quantized Transfer Learning for Computer Vision Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../static_quantization_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (beta) Static Quantization with Eager Mode in PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/torchserve_with_ipex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grokking PyTorch Intel CPU performance from first principles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/torchserve_with_ipex_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grokking PyTorch Intel CPU performance from first principles (Part 2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/nvfuser_intro_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started - Accelerate Your Scripts with nvFuser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/ax_multiobjective_nas_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-Objective NAS with Ax
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/torch_compile_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to torch.compile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/inductor_debug_cpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inductor CPU backend debugging and profiling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/scaled_dot_product_attention_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (Beta) Implementing High-Performance Transformers with Scaled Dot Product Attention (SDPA)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/scaled_dot_product_attention_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (Beta) Implementing High-Performance Transformers with Scaled Dot Product Attention (SDPA)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/scaled_dot_product_attention_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (Beta) Implementing High-Performance Transformers with Scaled Dot Product Attention (SDPA)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/scaled_dot_product_attention_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    (Beta) Implementing High-Performance Transformers with Scaled Dot Product Attention (SDPA)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/knowledge_distillation_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Knowledge Distillation Tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_16" >
        
          
          <label class="md-nav__link" for="__nav_3_1_16" id="__nav_3_1_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Parallel and Distributed Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_16">
            <span class="md-nav__icon md-icon"></span>
            Parallel and Distributed Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distributed/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed and Parallel Training Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/dist_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch Distributed Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/ddp_series_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed Data Parallel in PyTorch - Video Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/model_parallel_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single-Machine Model Parallel Best Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/ddp_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started with Distributed Data Parallel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/dist_tuto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing Distributed Applications with PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/FSDP_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started with Fully Sharded Data Parallel(FSDP)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/FSDP_adavnced_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Model Training with Fully Sharded Data Parallel (FSDP)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/TP_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Large Scale Transformer model training with Tensor Parallel (TP)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/process_group_cpp_extension_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize Process Group Backends Using Cpp Extensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/rpc_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started with Distributed RPC Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/rpc_param_server_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementing a Parameter Server Using Distributed RPC Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/dist_pipeline_parallel_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed Pipeline Parallelism Using RPC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/rpc_async_execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementing Batch RPC Processing Using Asynchronous Executions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rpc_ddp_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Combining Distributed DataParallel with Distributed RPC Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ddp_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training Transformer models using Distributed Data Parallel and Pipeline Parallelism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generic_join/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed Training with Uneven Inputs Using the Join Context Manager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_17" >
        
          
          <label class="md-nav__link" for="__nav_3_1_17" id="__nav_3_1_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Edge with ExecuTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_17">
            <span class="md-nav__icon md-icon"></span>
            Edge with ExecuTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/tutorials/export-to-executorch-tutorial.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exporting to ExecuTorch Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/running-a-model-cpp-tutorial.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running an ExecuTorch Model in C++ Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/tutorials/sdk-integration-tutorial.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using the ExecuTorch SDK to Profile a Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/demo-apps-ios.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building an ExecuTorch iOS Demo App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/demo-apps-android.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building an ExecuTorch Android Demo App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/executorch/stable/examples-end-to-end-to-lower-model-to-delegate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lowering a Model as a Delegate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_18" >
        
          
          <label class="md-nav__link" for="__nav_3_1_18" id="__nav_3_1_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recommendation Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_18">
            <span class="md-nav__icon md-icon"></span>
            Recommendation Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../intermediate/torchrec_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to TorchRec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exploring TorchRec sharding
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_19" >
        
          
          <label class="md-nav__link" for="__nav_3_1_19" id="__nav_3_1_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Multimodality
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_19">
            <span class="md-nav__icon md-icon"></span>
            Multimodality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginner/flava_finetuning_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchMultimodal Tutorial: Finetuning FLAVA
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    中文文档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            中文文档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/docs/stable/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/audio/stable/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Torchaudio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/text/stable/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchText
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/vision/stable/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchVision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/torcharrow/beta/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchArrow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/torchrec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchRec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/serve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchServe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/torchx/latest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TorchX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch.org/xla/release/2.3/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch on XLA Devices
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch1x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 1.7 中文文档
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch1x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 1.4 中文文档 & 教程
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch1x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 1.0 中文文档 & 教程
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch0x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 0.4 中文文档
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch0x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 0.3 中文文档 & 教程
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pytorch0x.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch 0.2 中文文档
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contrib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    贡献指南
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.apachecn.org/about" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于我们
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.apachecn.org/join" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    加入我们
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.apachecn.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    中文资源合集
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      主要学习内容：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_step" class="md-nav__link">
    <span class="md-ellipsis">
      对动作的效果进行编码：_step()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_reset" class="md-nav__link">
    <span class="md-ellipsis">
      重置模拟器：_reset()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#env_spec" class="md-nav__link">
    <span class="md-ellipsis">
      环境元数据 env.*_spec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specs-shape" class="md-nav__link">
    <span class="md-ellipsis">
      Specs shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      可重复的实验：播种
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#envbase" class="md-nav__link">
    <span class="md-ellipsis">
      将事物包装在一起：EnvBase类
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      测试我们的环境
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      转换环境
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      编写自定义转换
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      执行
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batching" class="md-nav__link">
    <span class="md-ellipsis">
      Batching 计算
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      训练一个简单的策略
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      训练循环
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/apachecn/pytorch-doc-zh/edit/master/docs/2.0/tutorials/advanced/pendulum.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/apachecn/pytorch-doc-zh/raw/master/docs/2.0/tutorials/advanced/pendulum.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="pytorch-pendulum-torchrl">PyTorch Pendulum：使用 TorchRL 进行物理环境模拟</h1>
<blockquote>
<p>译者：<a href="https://github.com/sanxincao">先天亏钱圣体</a></p>
<p>项目地址：<a href="https://pytorch.apachecn.org/2.0/tutorials/advanced/pendulum">https://pytorch.apachecn.org/2.0/tutorials/advanced/pendulum</a></p>
<p>原始地址：<a href="https://pytorch.org/tutorials//advanced/pendulum.html">https://pytorch.org/tutorials//advanced/pendulum.html</a></p>
</blockquote>
<p>创建环境（模拟器或物理控制系统的接口）是强化学习和控制工程的集成部分。  </p>
<p>TorchRL 提供了一组工具来在执行此操作。本教程演示如何使用 PyTorch 和 TorchRL 从头开始​​编写钟摆模拟器。 它的灵感来自<a href="https://github.com/Farama-Foundation/Gymnasium">OpenAI-Gym/Farama-Gymnasium</a> 控制库的 Pendulum-v1 实现。</p>
<h3 id="_1">主要学习内容：</h3>
<ul>
<li>如何在 TorchRL 中设计环境模拟： - 编写规则（输入、观察和奖励）； - 实现行为：初始化、重置和步进。 </li>
<li>转换您的环境输入和输出，并编写您自己的转换。</li>
<li>如何使用TensorDict来携带任何结构的数据通过codebase，在此过程中，我们将接触 TorchRL 的三个关键组成部分：</li>
<li><a href="https://pytorch.org/rl/reference/envs.html">环境</a> </li>
<li><a href="https://pytorch.org/rl/reference/transforms.html">转换</a> </li>
<li><a href="https://pytorch.org/rl/reference/modules.html">策略</a> (策略和价值函数) </li>
</ul>
<p>为了了解 TorchRL 环境可以实现的目标，我们将设计一个无状态环境。有状态环境会跟踪遇到的最新物理状态并依靠它来模拟状态到状态的转换，而无状态环境则希望在每个步骤中向它们提供当前状态以及所采取的操作。（想吐槽）TorchRL 支持这两种类型的环境，但无状态环境更通用，因此涵盖了 TorchRL 中更广泛的功能的环境 API。 </p>
<p>对无状态环境进行建模使用户可以完全控制模拟器的输入和输出：可以在任何阶段重置实验或主动从外部修改动态。然而，它假设我们可以完全控制任务，或者可以有极强的控制能力。但情况可能并非总是如此：解决我们无法控制当前状态的问题更具挑战性，而且具有更广泛的应用范围。  </p>
<p>无状态环境的另一个优点是它们可以批量执行转换模拟。如果后端和实现允许，可以在标量、向量或张量上无缝执行代数运算。本教程给出了这样的例子。</p>
<p>本教程的结构如下：
* 我们首先要熟悉环境属性：它的形状（batch_size），它的方法（主要是step()， reset()和set_seed()），最后是它的规则。 
* 写好模拟器后，我们将演示如何在转换训练期间使用它。
* 我们将探索 TorchRL API 的新途径，包括：转换输入的可能性、模拟的矢量化执行以及通过模拟图反向传播的可能性。
* 最后，我们将训练一个简单的策略来解决我们实现的系统。</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>from collections import defaultdict
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>from typing import Optional
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>import numpy as np
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>import torch
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>import tqdm
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>from tensordict import TensorDict, TensorDictBase
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>from tensordict.nn import TensorDictModule
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>from torch import nn
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>from torchrl.data import BoundedTensorSpec, CompositeSpec, UnboundedContinuousTensorSpec
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>from torchrl.envs import (
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    CatTensors,
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    EnvBase,
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    Transform,
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    TransformedEnv,
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    UnsqueezeTransform,
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>)
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>from torchrl.envs.transforms.transforms import _apply_to_composite
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>from torchrl.envs.utils import check_env_specs, step_mdp
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>DEFAULT_X = np.pi
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>DEFAULT_Y = 1.0
</code></pre></div>
设计新环境类时必须注意四件事： 
* EnvBase._reset()，该代码用于将模拟器重置为（可能是随机的）初始状态；
* EnvBase._step()状态转换动态代码；
* EnvBase._set_seed`()实施种子机制；
* 环境规则 </p>
<p>让我们首先描述当前的问题：我们想要模拟一个简单的钟摆，通过它我们可以控制施加在其固定点上的扭矩。我们的目标是将摆锤置于向上位置（按照惯例，角度位置为 0）并使其静止在该位置。为了设计我们的动态系统，我们需要定义两个方程：动作（施加的扭矩）后的运动方程和构成我们目标函数的奖励方程。</p>
<p>对于运动方程，我们将更新角速度如下：
$$
\dot{\theta}<em t_1="t+1">{t+1} = \dot{\theta}_t + dt \left( \frac{G}{L} \sin(\theta) + \frac{u}{mL^2} \right)
$$
公式中𝜃点是以 rad/sec 为单位的角速度，𝐺是引力，𝐿是摆的长度，m是它的质量， 𝜃是它的角位置并且
u是扭矩。然后根据以下公式更新角位置：
$$
\theta</em>
$$} = \theta + dt \cdot \dot{\theta}_{t+1<br />
(不会写下标，凑活看)</p>
<p>定义奖励方程：
$$
r = -({\theta}^2+0.1<em>\dot{\theta}^2+0.001</em>u^2)
$$</p>
<p>当角度接近 0（摆处于向上位置）、角速度接近 0（无运动）且扭矩也为 0 时，该值将最大化。</p>
<h2 id="_step">对动作的效果进行编码：_step()</h2>
<p>步进的方法是首要考虑的事，因为他是对我们感兴趣事务的编码。在 TorchRL 中， EnvBase该类有一个EnvBase.step() 方法，用于接收一个tensordict.TensorDict 实例，该"action"实例带有一个指示要采取什么操作的条目。  </p>
<p>为了在tensordict中方便读取和写入，确保密钥与库所期望的一致，模拟部分已委托给一个私有抽象方法_step()， 该方法从一个tensordict 读取输入数据，并使用输出数据写入新的 tensordict数据。  </p>
<p>该_step()方法应该执行以下操作：
* 读取输入按键（如"action"）并据此执行模拟 
* 检索观察结果、完成状态和奖励
* 将观察值集以及奖励和完成状态写入新的相关TensorDict中  </p>
<p>接下来step()方法将合并tensordict的输入与step()的输出，确保输入输出的一致性。<br />
通常，对于有状态环境，这将如下所示： 
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>&gt;&gt;&gt; policy(env.reset())
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>&gt;&gt;&gt; print(tensordict)
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>TensorDict(
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    fields={
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        action: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.float32, is_shared=False),
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        done: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.bool, is_shared=False),
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        observation: Tensor(shape=torch.Size([]), device=cpu, dtype=torch.float32, is_shared=False)},
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    batch_size=torch.Size([]),
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    device=cpu,
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    is_shared=False)
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>&gt;&gt;&gt; env.step(tensordict)
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>&gt;&gt;&gt; print(tensordict)
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>TensorDict(
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    fields={
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        action: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.float32, is_shared=False),
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>        done: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.bool, is_shared=False),
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        next: TensorDict(
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>            fields={
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>                done: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.bool, is_shared=False),
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>                observation: Tensor(shape=torch.Size([]), device=cpu, dtype=torch.float32, is_shared=False),
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>                reward: Tensor(shape=torch.Size([1]), device=cpu, dtype=torch.float32, is_shared=False)},
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>            batch_size=torch.Size([]),
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>            device=cpu,
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>            is_shared=False),
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        observation: Tensor(shape=torch.Size([]), device=cpu, dtype=torch.float32, is_shared=False)},
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    batch_size=torch.Size([]),
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    device=cpu,
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>    is_shared=False)
</code></pre></div>
请注意，根tensordict没有变化,唯一的修改是出现了一个新的‘next’条目，其中包含了新信息。<br />
在钟摆示例中，我们的_step()方法将从输入中读取相关条目，并在将按键编码（"action" key 行为按键）的力施加到钟摆上tensordict后计算钟摆的位置和速度。我们将摆锤的新角位置计算 为先前位置加上一段时间间隔内的新速度"new_th"的结果。 </p>
<p>由于我们的目标是将钟摆向上转动并将其保持在该位置，因此cost对于接近目标的位置和低速，我们的（负奖励）函数较低。事实上，我们希望阻止远离“向上”的位置和/或远离 0 的速度。</p>
<p>在我们的示例中，EnvBase._step()由于我们的环境是无状态的，因此被编码为静态方法。在有状态设置中，self需要该参数，因为需要从环境中读取状态。
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>def _step(tensordict):
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    th, thdot = tensordict[&quot;th&quot;], tensordict[&quot;thdot&quot;]  # th := theta
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    g_force = tensordict[&quot;params&quot;, &quot;g&quot;]
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    mass = tensordict[&quot;params&quot;, &quot;m&quot;]
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    length = tensordict[&quot;params&quot;, &quot;l&quot;]
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    dt = tensordict[&quot;params&quot;, &quot;dt&quot;]
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    u = tensordict[&quot;action&quot;].squeeze(-1)
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    u = u.clamp(-tensordict[&quot;params&quot;, &quot;max_torque&quot;], tensordict[&quot;params&quot;, &quot;max_torque&quot;])
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    costs = angle_normalize(th) ** 2 + 0.1 * thdot**2 + 0.001 * (u**2)
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    new_thdot = (
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>        thdot
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        + (3 * g_force / (2 * length) * th.sin() + 3.0 / (mass * length**2) * u) * dt
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    )
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    new_thdot = new_thdot.clamp(
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        -tensordict[&quot;params&quot;, &quot;max_speed&quot;], tensordict[&quot;params&quot;, &quot;max_speed&quot;]
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    )
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    new_th = th + new_thdot * dt
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    reward = -costs.view(*tensordict.shape, 1)
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    done = torch.zeros_like(reward, dtype=torch.bool)
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    out = TensorDict(
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>        {
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>            &quot;th&quot;: new_th,
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>            &quot;thdot&quot;: new_thdot,
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>            &quot;params&quot;: tensordict[&quot;params&quot;],
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>            &quot;reward&quot;: reward,
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>            &quot;done&quot;: done,
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        },
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>        tensordict.shape,
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    )
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    return out
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>def angle_normalize(x):
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>    return ((x + torch.pi) % (2 * torch.pi)) - torch.pi
</code></pre></div></p>
<h2 id="_reset">重置模拟器：_reset()</h2>
<p>我们需要关心的第二个方法是 _reset()方法。就像 _step()，它应该在它的输出中写入观察条目和可能的完成状态（如果省略完成状态，它将由父方法 tensordict填充失败）。在某些情况下，reset方法需要从调用它的函数接收命令（例如，在多智能体设置中，我们可能想要指明哪些智能体需要被重置）。 这也是为什么_reset同样需要一个tensordict作为输入参数。，尽管它可能完全为空。<br />
父级EnvBase.reset()会像EnvBase.step()一样执行一些简单的检查 ，例如确保"done"输出中返回状态tensordict以及形状与规则中的预期相匹配。 <br />
对于我们来说，唯一需要考虑的重要事情是是否 EnvBase._reset()包含所有预期的观察结果。由于我们正在使用无状态环境，因此我们将钟摆的配置传递到嵌套的tensordict名为"params". <br />
在这个例子中，我们没有传递完成状态，因为这不是强制性的，_reset()而且我们的环境是非终止的，所以我们总是期望它是False。
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>def _reset(self, tensordict):
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    if tensordict is None or tensordict.is_empty():
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        # if no ``tensordict`` is passed, we generate a single set of hyperparameters
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        # Otherwise, we assume that the input ``tensordict`` contains all the relevant
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        # parameters to get started.
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        tensordict = self.gen_params(batch_size=self.batch_size)
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    high_th = torch.tensor(DEFAULT_X, device=self.device)
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    high_thdot = torch.tensor(DEFAULT_Y, device=self.device)
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    low_th = -high_th
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    low_thdot = -high_thdot
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    # for non batch-locked environments, the input ``tensordict`` shape dictates the number
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    # of simulators run simultaneously. In other contexts, the initial
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    # random state&#39;s shape will depend upon the environment batch-size instead.
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    th = (
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        torch.rand(tensordict.shape, generator=self.rng, device=self.device)
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>        * (high_th - low_th)
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        + low_th
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    )
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    thdot = (
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        torch.rand(tensordict.shape, generator=self.rng, device=self.device)
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        * (high_thdot - low_thdot)
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>        + low_thdot
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>    )
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>    out = TensorDict(
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        {
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>            &quot;th&quot;: th,
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>            &quot;thdot&quot;: thdot,
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>            &quot;params&quot;: tensordict[&quot;params&quot;],
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        },
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        batch_size=tensordict.shape,
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>    )
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>    return out
</code></pre></div></p>
<h2 id="env_spec">环境元数据 env.*_spec</h2>
<p>规则定义了环境的输入和输出域。规则准确定义将在运行时接收的张量非常重要，因为它们通常用于携带有关多处理和多进程中的环境的信息。它们还可以用于实例化延迟定义的神经网络和测试脚本，而无需实际查询环境（例如，对于现实世界的物理系统来说，这可能成本高昂）。<br />
我们必须在我们的环境中编写四个规范：
* EnvBase.observation_spec: 这将是一个CompositeSpec 实例，其中每个键都是一个观察值（CompositeSpec可以被视为规则字典）。
* EnvBase.action_spec: 可以是任意类型的spec，但要求与"action"input中的条目对应tensordict；
* EnvBase.reward_spec:提供有关奖励空间的信息；
* EnvBase.done_spec:提供有关完成状态的信息。
TorchRL 规则被组织在两个通用容器中：input_spec其中包含步骤函数读取的信息规则（分为action_spec包含操作和state_spec包含所有其余内容）。以及output_spec对步骤输出的规则进行编码（observation_spec、reward_spec和done_spec）。一般来说，您不应该直接与output_spec和 input_spec的交互，而是应该和他们的内容交互: observation_spec, reward_spec, done_spec, action_spec and state_spec。原因是规则可能是以非正常方式构建的，output_spec and input_spec都不应该被直接修改。  </p>
<p>换句话说，observation_spec和相关属性是输出和输入规范容器内容的便捷快捷方式。<br />
TorchRL 提供多个TensorSpec 子类来编码环境的输入和输出特征。  </p>
<h2 id="specs-shape">Specs shape</h2>
<p>环境规则主要尺寸必须与环境批量大小相匹配。这样做是为了强制环境的每个组件（包括其转换）都能够准确表示预期的输入和输出形状。这是应该在有状态设置中准确编码的内容。  </p>
<p>对于非批量锁定环境，例如我们示例中的环境（见下文），这是无关紧要的，因为环境批量大小很可能为空。
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>def _make_spec(self, td_params):
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    # Under the hood, this will populate self.output_spec[&quot;observation&quot;]
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    self.observation_spec = CompositeSpec(
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>        th=BoundedTensorSpec(
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>            low=-torch.pi,
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>            high=torch.pi,
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>            shape=(),
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>            dtype=torch.float32,
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        ),
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        thdot=BoundedTensorSpec(
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>            low=-td_params[&quot;params&quot;, &quot;max_speed&quot;],
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>            high=td_params[&quot;params&quot;, &quot;max_speed&quot;],
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>            shape=(),
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>            dtype=torch.float32,
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>        ),
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        # we need to add the ``params`` to the observation specs, as we want
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>        # to pass it at each step during a rollout
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        params=make_composite_from_td(td_params[&quot;params&quot;]),
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>        shape=(),
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    )
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    # since the environment is stateless, we expect the previous output as input.
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    # For this, ``EnvBase`` expects some state_spec to be available
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>    self.state_spec = self.observation_spec.clone()
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    # action-spec will be automatically wrapped in input_spec when
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    # `self.action_spec = spec` will be called supported
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>    self.action_spec = BoundedTensorSpec(
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>        low=-td_params[&quot;params&quot;, &quot;max_torque&quot;],
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        high=td_params[&quot;params&quot;, &quot;max_torque&quot;],
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        shape=(1,),
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>        dtype=torch.float32,
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>    )
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>    self.reward_spec = UnboundedContinuousTensorSpec(shape=(*td_params.shape, 1))
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>def make_composite_from_td(td):
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>    # custom function to convert a ``tensordict`` in a similar spec structure
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>    # of unbounded values.
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>    composite = CompositeSpec(
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>        {
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>            key: make_composite_from_td(tensor)
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>            if isinstance(tensor, TensorDictBase)
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>            else UnboundedContinuousTensorSpec(
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>                dtype=tensor.dtype, device=tensor.device, shape=tensor.shape
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>            )
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>            for key, tensor in td.items()
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>        },
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>        shape=td.shape,
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>    )
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>    return composite
</code></pre></div></p>
<h2 id="_2">可重复的实验：播种</h2>
<p>初始化环境时播种环境是一项常见操作。唯一的目标EnvBase._set_seed()是设置所包含模拟器的种子。如果可能，此操作不应调用环境执行reset()或与环境执行交互。父EnvBase.set_seed()方法采用了一种机制，允许使用不同的伪随机且可重现的种子播种多个环境。<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>def _set_seed(self, seed: Optional[int]):
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    rng = torch.manual_seed(seed)
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    self.rng = rng
</code></pre></div></p>
<h2 id="envbase">将事物包装在一起：EnvBase类</h2>
<p>我们终于可以将各个部分组合在一起并设计我们的环境类。环境构建过程中需要进行specs初始化，因此我们必须注意_make_spec()调用PendulumEnv.<strong>init</strong>().</p>
<p>我们添加一个静态方法PendulumEnv.gen_params()，它确定性地生成一组在执行期间使用的超参数： 
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>def gen_params(g=10.0, batch_size=None) -&gt; TensorDictBase:
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    &quot;&quot;&quot;Returns a ``tensordict`` containing the physical parameters such as gravitational force and torque or speed limits.&quot;&quot;&quot;
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    if batch_size is None:
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>        batch_size = []
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    td = TensorDict(
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>        {
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            &quot;params&quot;: TensorDict(
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>                {
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>                    &quot;max_speed&quot;: 8,
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>                    &quot;max_torque&quot;: 2.0,
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>                    &quot;dt&quot;: 0.05,
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>                    &quot;g&quot;: g,
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>                    &quot;m&quot;: 1.0,
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>                    &quot;l&quot;: 1.0,
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>                },
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>                [],
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>            )
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        },
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        [],
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    )
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    if batch_size:
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>        td = td.expand(batch_size).contiguous()
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    return td
</code></pre></div>
batch_locked我们通过将homonymous 属性转换为 来将环境定义为非False。这意味着我们不会强制输入 tensordict与batch-size环境相匹配。</p>
<p>下面的代码将把我们上面编码的部分组合在一起。<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>class PendulumEnv(EnvBase):
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    metadata = {
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        &quot;render_modes&quot;: [&quot;human&quot;, &quot;rgb_array&quot;],
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        &quot;render_fps&quot;: 30,
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    }
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    batch_locked = False
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    def __init__(self, td_params=None, seed=None, device=&quot;cpu&quot;):
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        if td_params is None:
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>            td_params = self.gen_params()
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        super().__init__(device=device, batch_size=[])
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>        self._make_spec(td_params)
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        if seed is None:
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>            seed = torch.empty((), dtype=torch.int64).random_().item()
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        self.set_seed(seed)
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    # Helpers: _make_step and gen_params
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    gen_params = staticmethod(gen_params)
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    _make_spec = _make_spec
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    # Mandatory methods: _step, _reset and _set_seed
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    _reset = _reset
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    _step = staticmethod(_step)
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    _set_seed = _set_seed
</code></pre></div></p>
<h2 id="_3">测试我们的环境</h2>
<p>TorchRL 提供了一个简单的函数check_env_specs() 来检查（转换后的）环境是否具有与其规范规定的输入/输出结构相匹配的输入/输出结构。让我们尝试一下：
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>env = PendulumEnv()
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>check_env_specs(env)
</code></pre></div>
我们可以查看我们的规范，以直观地表示环境签名：<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>print(&quot;observation_spec:&quot;, env.observation_spec)
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>print(&quot;state_spec:&quot;, env.state_spec)
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>print(&quot;reward_spec:&quot;, env.reward_spec)
</code></pre></div>
我们也可以执行几个命令来检查输出结构是否符合预期。
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>td = env.reset()
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>print(&quot;reset tensordict&quot;, td)
</code></pre></div>
我们可以运行env.rand_step()从域中随机生成一个动作action_spec。由于我们的环境是无状态的，因此必须传递tensordict包含超参数和当前状态的A 。在有状态的上下文中，env.rand_step()也能完美工作。
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>td = env.rand_step(td)
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>print(&quot;random step tensordict&quot;, td)
</code></pre></div></p>
<h2 id="_4">转换环境</h2>
<p>为无状态模拟器编写环境转换比有状态模拟器稍微复杂一些：转换需要在以下迭代中读取的输出条目需要在meth.step()下一步调用之前应用逆变换。这是展示 TorchRL 变换的所有功能的理想场景！ 
例如，在下面的转换环境中，我们的unsqueeze条目 能够沿着最后一个维度堆叠它们。一旦它们作为下一次迭代的输入传递，我们还将它们传递为将它们压缩回原始形状。 
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>env = TransformedEnv(
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    env,
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    # ``Unsqueeze`` the observations that we will concatenate
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    UnsqueezeTransform(
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>        unsqueeze_dim=-1,
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>        in_keys=[&quot;th&quot;, &quot;thdot&quot;],
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        in_keys_inv=[&quot;th&quot;, &quot;thdot&quot;],
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    ),
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>)
</code></pre></div></p>
<h2 id="_5">编写自定义转换</h2>
<p>TorchRL 的转换可能无法涵盖环境执行后想要执行的所有操作。编写转换并不需要太多努力。至于环境设计，编写转换有两个步骤：
* 获得正确的动作（正向和反向）
* 能够适应环境的规则<br />
转换可以在两种设置中使用：就其本身而言，它可以用作 Module.它也可以附加到 TransformedEnv.类的结构允许自定义不同上下文中的行为。一个Transform骨架可以概括如下：
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>class Transform(nn.Module):
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    def forward(self, tensordict):
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        ...
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    def _apply_transform(self, tensordict):
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        ...
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    def _step(self, tensordict):
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        ...
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    def _call(self, tensordict):
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        ...
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    def inv(self, tensordict):
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        ...
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    def _inv_apply_transform(self, tensordict):
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        ...
</code></pre></div>
共有三个入口点（forward()、_step()和inv()），它们都接收tensordict.TensorDict实例。前两个最终将遍历由 指示的键in_keys 并调用_apply_transform()其中的每一个。如果提供的话，结果将写入所指向的条目中Transform.out_keys（如果没有，in_keys将使用转换后的值进行更新）。如果需要执行逆变换，则将执行类似的数据流，但使用Transform.inv()和 Transform._inv_apply_transform()方法并跨键in_keys_inv 和out_keys_inv列表。下图总结了环境和重播缓冲区的流程。<br />
(文档并没有给图哥们)<br />
在某些情况下，转换不会以单一方式处理键的子集，而是会在父环境上执行某些操作或处理整个输入tensordict。在这些情况下，应该重写_call()和方法，并且可以跳过该方法。forward()_apply_transform()</p>
<p>让我们编写新的变换来计算位置角度的sin和cos 值，因为这些值比原始角度值更有助于我们学习策略。
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>class SinTransform(Transform):
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    def _apply_transform(self, obs: torch.Tensor) -&gt; None:
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>        return obs.sin()
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    # The transform must also modify the data at reset time
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    def _reset(
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        self, tensordict: TensorDictBase, tensordict_reset: TensorDictBase
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    ) -&gt; TensorDictBase:
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>        return self._call(tensordict_reset)
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    # _apply_to_composite will execute the observation spec transform across all
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    # in_keys/out_keys pairs and write the result in the observation_spec which
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    # is of type ``Composite``
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    @_apply_to_composite
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    def transform_observation_spec(self, observation_spec):
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        return BoundedTensorSpec(
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>            low=-1,
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>            high=1,
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>            shape=observation_spec.shape,
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>            dtype=observation_spec.dtype,
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>            device=observation_spec.device,
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        )
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>class CosTransform(Transform):
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    def _apply_transform(self, obs: torch.Tensor) -&gt; None:
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        return obs.cos()
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>    # The transform must also modify the data at reset time
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>    def _reset(
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>        self, tensordict: TensorDictBase, tensordict_reset: TensorDictBase
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    ) -&gt; TensorDictBase:
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>        return self._call(tensordict_reset)
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>    # _apply_to_composite will execute the observation spec transform across all
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>    # in_keys/out_keys pairs and write the result in the observation_spec which
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>    # is of type ``Composite``
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>    @_apply_to_composite
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>    def transform_observation_spec(self, observation_spec):
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>        return BoundedTensorSpec(
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>            low=-1,
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>            high=1,
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>            shape=observation_spec.shape,
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>            dtype=observation_spec.dtype,
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>            device=observation_spec.device,
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>        )
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>t_sin = SinTransform(in_keys=[&quot;th&quot;], out_keys=[&quot;sin&quot;])
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>t_cos = CosTransform(in_keys=[&quot;th&quot;], out_keys=[&quot;cos&quot;])
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>env.append_transform(t_sin)
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>env.append_transform(t_cos)
</code></pre></div>
将观察结果连接到“观察”条目。 del_keys=False确保我们为下一次迭代保留这些值。
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>cat_transform = CatTensors(
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    in_keys=[&quot;sin&quot;, &quot;cos&quot;, &quot;thdot&quot;], dim=-1, out_key=&quot;observation&quot;, del_keys=False
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>)
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>env.append_transform(cat_transform)
</code></pre></div>
让我们再次检查我们的环境规格是否与收到的规格相符：
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>check_env_specs(env)
</code></pre></div></p>
<h2 id="_6">执行</h2>
<p>执行需要几个简单的步骤
* 重置环境
* 当某些条件不满足时：
  * 计算给定策略的操作
  * 执行给定此操作的步骤
  * 收集数据
  * 迈出MDP一步(?)
* 收集数据并返回<br />
这些操作已方便地包装在rollout() 方法中，我们在下面提供了一个简化版本。
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>def simple_rollout(steps=100):
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    # preallocate:
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    data = TensorDict({}, [steps])
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    # reset
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    _data = env.reset()
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    for i in range(steps):
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>        _data[&quot;action&quot;] = env.action_spec.rand()
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        _data = env.step(_data)
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>        data[i] = _data
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        _data = step_mdp(_data, keep_other=True)
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    return data
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>print(&quot;data from rollout:&quot;, simple_rollout(100))
</code></pre></div></p>
<h2 id="batching">Batching 计算</h2>
<p>我们教程的最后一个未探索的部分是我们必须在 TorchRL 中进行批量计算的能力。由于我们的环境不对输入数据形状做出任何假设，因此我们可以在批量数据上无缝执行它。更好的是：对于非批量锁定的环境（例如我们的 Pendulum），我们可以动态更改批量大小，而无需重新创建环境。为此，我们只需生成具有所需形状的参数。<br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>batch_size = 10  # number of environments to be executed in batch
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>td = env.reset(env.gen_params(batch_size=[batch_size]))
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>print(&quot;reset (batch size of 10)&quot;, td)
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>td = env.rand_step(td)
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>print(&quot;rand step (batch size of 10)&quot;, td)
</code></pre></div>
使用一批数据执行 rollout 需要我们重置 rollout 函数中的环境，因为我们需要动态定义 batch_size 而这不受以下支持rollout()：
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>rollout = env.rollout(
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    3,
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    auto_reset=False,  # we&#39;re executing the reset out of the ``rollout`` call
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    tensordict=env.reset(env.gen_params(batch_size=[batch_size])),
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>)
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>print(&quot;rollout of len 3 (batch size of 10):&quot;, rollout)
</code></pre></div></p>
<h2 id="_7">训练一个简单的策略</h2>
<p>在此示例中，我们将使用奖励作为可微目标（例如负损失）来训练一个简单的策略。我们将利用动态系统完全可微的事实，通过轨迹返回进行反向传播，并调整我们的策略权重以直接最大化该值。当然，在许多设置中，我们所做的许多假设都不成立，例如可微分系统和对底层机制的完全访问。  </p>
<p>尽管如此，这仍然是一个非常简单的示例，展示了如何使用 TorchRL 中的自定义环境对训练循环进行编码。</p>
<p>我们先来写一下策略网络：
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>torch.manual_seed(0)
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>env.set_seed(0)
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>net = nn.Sequential(
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    nn.LazyLinear(64),
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    nn.Tanh(),
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    nn.LazyLinear(64),
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    nn.Tanh(),
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    nn.LazyLinear(64),
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    nn.Tanh(),
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    nn.LazyLinear(1),
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>)
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>policy = TensorDictModule(
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    net,
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    in_keys=[&quot;observation&quot;],
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>    out_keys=[&quot;action&quot;],
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>)
</code></pre></div>
和我们的优化器：
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>optim = torch.optim.Adam(policy.parameters(), lr=2e-3)
</code></pre></div></p>
<h2 id="_8">训练循环</h2>
<p>我们将陆续：
* 生成轨迹
* 总结奖励
* 通过这些操作定义的图进行反向传播
* 裁剪梯度范数并进行优化步骤
* 重复</p>
<p>在训练循环结束时，我们应该得到接近 0 的最终奖励，这表明钟摆是向上的并且仍然符合预期。
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>batch_size = 32
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>pbar = tqdm.tqdm(range(20_000 // batch_size))
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>scheduler = torch.optim.lr_scheduler.CosineAnnealingLR(optim, 20_000)
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>logs = defaultdict(list)
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>for _ in pbar:
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    init_td = env.reset(env.gen_params(batch_size=[batch_size]))
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    rollout = env.rollout(100, policy, tensordict=init_td, auto_reset=False)
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    traj_return = rollout[&quot;next&quot;, &quot;reward&quot;].mean()
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    (-traj_return).backward()
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    gn = torch.nn.utils.clip_grad_norm_(net.parameters(), 1.0)
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    optim.step()
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    optim.zero_grad()
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    pbar.set_description(
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        f&quot;reward: {traj_return: 4.4f}, &quot;
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>        f&quot;last reward: {rollout[..., -1][&#39;next&#39;, &#39;reward&#39;].mean(): 4.4f}, gradient norm: {gn: 4.4}&quot;
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    )
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    logs[&quot;return&quot;].append(traj_return.item())
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>    logs[&quot;last_reward&quot;].append(rollout[..., -1][&quot;next&quot;, &quot;reward&quot;].mean().item())
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    scheduler.step()
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>def plot():
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>    import matplotlib
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>    from matplotlib import pyplot as plt
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>    is_ipython = &quot;inline&quot; in matplotlib.get_backend()
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>    if is_ipython:
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>        from IPython import display
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>    with plt.ion():
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>        plt.figure(figsize=(10, 5))
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>        plt.subplot(1, 2, 1)
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>        plt.plot(logs[&quot;return&quot;])
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>        plt.title(&quot;returns&quot;)
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>        plt.xlabel(&quot;iteration&quot;)
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>        plt.subplot(1, 2, 2)
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>        plt.plot(logs[&quot;last_reward&quot;])
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>        plt.title(&quot;last reward&quot;)
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>        plt.xlabel(&quot;iteration&quot;)
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>        if is_ipython:
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>            display.display(plt.gcf())
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>            display.clear_output(wait=True)
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>        plt.show()
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>plot()
</code></pre></div></p>
<p><img src='https://pytorch.org/tutorials/_images/sphx_glr_pendulum_001.png' width=20% /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../intermediate/mario_rl_tutorial/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Train a Mario-playing RL Agent">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Train a Mario-playing RL Agent
              </div>
            </div>
          </a>
        
        
          
          <a href="../../beginner/onnx/intro_onnx/" class="md-footer__link md-footer__link--next" aria-label="Next: Introduction to ONNX">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Introduction to ONNX
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "navigation.footer"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>